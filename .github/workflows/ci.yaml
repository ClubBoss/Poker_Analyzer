name: L2 Tests (conditional)

on:
  pull_request:
  push:
    branches: [ main ]
  schedule:
    - cron: '0 1 * * *' # nightly (UTC)

concurrency:
  group: l2-tests-${{ github.event.pull_request.number || github.sha }}
  cancel-in-progress: true

jobs:
  l2:
    # Запускаем ТОЛЬКО когда явно просим:
    # - PR с лейблом 'full-ci', ИЛИ
    # - push в main с маркером '[full-ci]' в сообщении коммита, ИЛИ
    # - nightly cron
    if: ${{ (github.event_name == 'pull_request' && contains(join(github.event.pull_request.labels.*.name, ','), 'full-ci')) || (github.event_name == 'push' && contains(github.event.head_commit.message, '[full-ci]')) || github.event_name == 'schedule' }}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # Запускаем тесты только если есть релевантные изменения
      - name: Detect relevant changes
        id: filter
        uses: dorny/paths-filter@v3
        with:
          filters: |
            l2:
              - 'assets/packs/l2/**'
              - 'assets/packs/l3/**'
              - 'assets/packs/l3/demo/**'
              - 'assets/theory/**'
              - 'to
