<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pack Library Publisher Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; margin:20px; }
    label { display:block; margin-top:10px; }
    button { margin-right:6px; }
    pre { background:#f4f4f4; padding:10px; }
  </style>
</head>
<body>
<h1>Pack Library Publisher Dashboard</h1>
<form id="form">
  <label>Packs directory
    <input type="file" id="packsDir" webkitdirectory multiple>
  </label>
  <label>Path spec (.txt)
    <input type="file" id="pathSpec" accept=".txt">
  </label>
  <button type="button" id="validateBtn">Validate</button>
  <button type="button" id="publishBtn">Publish</button>
  <button type="button" id="dryRunBtn">Dry Run</button>
</form>
<pre id="output"></pre>
<script>
async function runPublish(dryRun, validateOnly) {
  const output = document.getElementById('output');
  output.textContent = 'Running...';
  const packs = document.getElementById('packsDir').files;
  const specFile = document.getElementById('pathSpec').files[0];
  if (!packs.length || !specFile) {
    output.textContent = 'Please select packs directory and path spec file.';
    return;
  }
  const formData = new FormData();
  for (const f of packs) {
    formData.append('packs', f, f.webkitRelativePath);
  }
  formData.append('spec', specFile);
  if (dryRun) formData.append('dryRun', '1');
  if (validateOnly) formData.append('validate', '1');
  try {
    const res = await fetch('/publish', {method: 'POST', body: formData});
    const json = await res.json();
    output.textContent = JSON.stringify(json, null, 2);
    if (json.indexUrl) {
      const link = document.createElement('a');
      link.href = json.indexUrl;
      link.textContent = 'index.json';
      output.appendChild(document.createElement('br'));
      output.appendChild(link);
    }
  } catch (e) {
    output.textContent = 'Error: ' + e;
  }
}

document.getElementById('validateBtn').onclick = () => runPublish(false, true);
document.getElementById('publishBtn').onclick = () => runPublish(false, false);
document.getElementById('dryRunBtn').onclick = () => runPublish(true, false);
</script>
</body>
</html>
